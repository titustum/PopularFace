<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-gray-200">
    <nav class="bg-black py-2 text-white">
        <div class="w-[90%] mx-auto">
            <h1 class="text-3xl font-bold">Face Recognition</h1>
        </div> 
        
    </nav>


    <div id="drop-area" class="rounded w-[90%] mx-auto mt-6 py-10 font-medium bg-white border-green-600 border-dashed border-2 text-center">
        <p><i class="fas fa-upload text-green-600 text-3xl"></i></p>
        <p>Drag & drop images here or click to select</p>
        <input type="file" id="file-input" style="display: none;" accept="image/*">
    </div>
    <div  class="w-[90%] mx-auto mt-6">
        <div class="grid grid-cols-3 gap-3" id="results">
            <!-- <div class="bg-white rounded-md p-2 grid grid-cols-2 gap-2">
                <img src="static/uploads/1ba70e30-98b9-49fc-9dc4-4ff446836c70.png" alt=""class="rounded">
                <div>
                    <h1 class="text-xl font-bold py-2 border-b-2 border-orange-600">Name: James Okay</h1>
                    <h1 class="mt-3 text-green-600">Match: 70%</h1>
                    <p class="mt-3">PS TVET</p>
                </div>
            </div> -->
        </div>
    </div>

    <script>
        // Function to handle file input change
        function handleFiles(files) {
            let formData = new FormData();
            formData.append('image', files[0]);
            submitForm(formData);
        }

        // Function to submit form data
        function submitForm(formData) {
            fetch('/checkface', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                displayResults(data);
            })
            .catch(error => console.error('Error:', error));
        }

        // Function to display results
        function displayResults(results) {
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Clear previous results
            results.forEach(function(result) {
                let userDiv = document.createElement('div');
                userDiv.innerHTML = `

                <div class="bg-white rounded-md p-2 grid grid-cols-2 gap-2">
                    <img src="/static/uploads/${result.image}" alt=""class="rounded h-[30vh] w-full object-cover">
                    <div>
                        <h1 class="text-xl font-bold py-2 border-b-2 border-orange-600">Name: ${result.name}</h1>
                        <h1 class="mt-3 text-green-600">Match: ${result.match}</h1>
                        <p class="mt-3">${result.about}</</p>
                    </div>
                </div> 
                `;
                resultsDiv.appendChild(userDiv);
            });
        }

        // Drag & drop event listeners
        let dropArea = document.getElementById('drop-area');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropArea.style.background = '#f2f2f2';
        }

        function unhighlight(e) {
            dropArea.style.background = '';
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            let dt = e.dataTransfer;
            let files = dt.files;
            handleFiles(files);
        }

        // Paste event listener
        document.addEventListener('paste', handlePaste);

        function handlePaste(e) {
            let items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    let blob = items[i].getAsFile();
                    let files = [blob];
                    handleFiles(files);
                    break;
                }
            }
        }

        // Click event listener for file input
        let fileInput = document.getElementById('file-input');
        dropArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            handleFiles(fileInput.files);
        });
    </script>
</body>
</html>
